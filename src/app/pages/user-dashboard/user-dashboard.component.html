<div class="dashboard-wrapper">
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="dashboard-sidebar">
      <div class="user-info">
        <img [src]="userProfile.avatar" alt="Avatar" class="user-avatar">
        <h3>{{ userProfile.name }}</h3>
        <p class="user-email">{{ userProfile.email }}</p>
        @if (userProfile.matricule) {
          <p class="user-matricule">Matricule: {{ userProfile.matricule }}</p>
        }
        @if (userProfile.memberSince) {
          <span class="member-badge">Membre depuis {{ userProfile.memberSince }}</span>
        }
      </div>

      <nav class="dashboard-nav">
        <button
          (click)="setActiveTab('courses')"
          [class.active]="activeTab === 'courses'"
          class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
          </svg>
          Mes Cours
        </button>

        <button
          (click)="setActiveTab('certificates')"
          [class.active]="activeTab === 'certificates'"
          class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="10" r="3"></circle>
            <path d="M12 2a10 10 0 0 0-9.95 9h4.53a9.93 9.93 0 0 1 5.42-5.42V2z"></path>
            <path d="M12 22a10 10 0 0 0 9.95-9h-4.53a9.93 9.93 0 0 1-5.42 5.42V22z"></path>
          </svg>
          Certifications
        </button>

        <button
          (click)="setActiveTab('profile')"
          [class.active]="activeTab === 'profile'"
          class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          Profil
        </button>
      </nav>

      <div class="dashboard-stats">
        <div class="stat-item">
          <span class="stat-number">{{ userProfile.totalClasses }}</span>
          <span class="stat-label">Cours inscrits</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ certificates.length }}</span>
          <span class="stat-label">Certificats</span>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="dashboard-main">
      <!-- My Courses Tab -->
      @if (activeTab === 'courses') {
        <div class="content-section">
          <div class="section-header">
            <h2>Mes Cours Inscrits</h2>
            <a routerLink="/formations" class="btn btn-primary">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Parcourir les cours
            </a>
          </div>

          @if (isLoading) {
            <div class="loading-state">
              <div class="spinner"></div>
              <p>Chargement de vos cours...</p>
            </div>
          } @else if (errorMessage) {
            <div class="error-state">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
              <h3>{{ errorMessage }}</h3>
              <p>Veuillez réessayer plus tard.</p>
            </div>
          } @else if (enrolledCourses.length === 0) {
            <div class="empty-state">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
              </svg>
              <h3>Aucun cours inscrit</h3>
              <p>Vous n'êtes inscrit à aucun cours pour le moment.</p>
              <a routerLink="/formations" class="btn btn-primary">Découvrir les formations</a>
            </div>
          } @else {
            <div class="courses-grid">
              @for (course of enrolledCourses; track course.classeId) {
                <div class="course-card" (click)="openCourse(course)">
                  <div class="course-image" [style.background-image]="'url(' + course.formationImage + ')'">
                    <span class="course-category">{{ course.classeName }}</span>
                    @if (course.isActive) {
                      <span class="course-status active">Actif</span>
                    } @else {
                      <span class="course-status inactive">Inactif</span>
                    }
                  </div>
                  <div class="course-content">
                    <h3>{{ course.formationTitle }}</h3>
                    @if (course.formationDescription) {
                      <p class="course-description">{{ course.formationDescription.length > 120 ? course.formationDescription.substring(0, 120) + '...' : course.formationDescription }}</p>
                    }
                    <div class="course-meta">
                      <span class="meta-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="14" height="14">
                          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                          <circle cx="9" cy="7" r="4"></circle>
                        </svg>
                        {{ course.nombreInscrits }} inscrits
                      </span>
                      @if (course.planFormation) {
                        <span class="meta-item">
                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="14" height="14">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                          </svg>
                          {{ course.planFormation.nom }}
                        </span>
                      }
                    </div>
                    <p class="classe-code">Code: {{ course.classeCode }}</p>
                    <button class="btn btn-outline btn-block" (click)="openCourse(course); $event.stopPropagation()">
                      Accéder au cours
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      }

      <!-- Certificates Tab -->
      @if (activeTab === 'certificates') {
        <div class="content-section">
          <div class="section-header">
            <h2>Mes Certifications</h2>
            <p>Certificats obtenus et en cours</p>
          </div>

          @if (certificates.length === 0) {
            <div class="empty-state">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="10" r="3"></circle>
                <path d="M12 2a10 10 0 0 0-9.95 9h4.53a9.93 9.93 0 0 1 5.42-5.42V2z"></path>
              </svg>
              <h3>Aucun certificat</h3>
              <p>Complétez des cours pour obtenir des certificats.</p>
            </div>
          } @else {
            <div class="certificates-grid">
              @for (cert of certificates; track cert.id) {
                <div class="certificate-card" [class.in-progress]="cert.status === 'in-progress'">
                  <div class="certificate-icon">
                    @if (cert.status === 'completed') {
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                      </svg>
                    } @else {
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                      </svg>
                    }
                  </div>
                  <div class="certificate-info">
                    <h3>{{ cert.courseName }}</h3>
                    <p class="certificate-id">{{ cert.certificateId }}</p>
                    @if (cert.issueDate) {
                      <p class="certificate-date">Délivré le {{ cert.issueDate }}</p>
                    }
                    @if (cert.status === 'completed') {
                      <span class="status-badge completed">Complété</span>
                    } @else {
                      <span class="status-badge in-progress">En cours</span>
                    }
                  </div>
                  @if (cert.status === 'completed') {
                    <button (click)="downloadCertificate(cert)" class="btn btn-outline">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                      </svg>
                      Télécharger
                    </button>
                  }
                </div>
              }
            </div>
          }
        </div>
      }

      <!-- Profile Tab -->
      @if (activeTab === 'profile') {
        <div class="content-section">
          <div class="section-header">
            <h2>Mon Profil</h2>
          </div>

          <div class="profile-content">
            <div class="profile-section">
              <h3>Informations Personnelles</h3>
              <div class="info-grid">
                <div class="info-item">
                  <label>Nom complet</label>
                  <p>{{ userProfile.name }}</p>
                </div>
                <div class="info-item">
                  <label>Email</label>
                  <p>{{ userProfile.email }}</p>
                </div>
                @if (userProfile.matricule) {
                  <div class="info-item">
                    <label>Matricule</label>
                    <p>{{ userProfile.matricule }}</p>
                  </div>
                }
                @if (userProfile.memberSince) {
                  <div class="info-item">
                    <label>Membre depuis</label>
                    <p>{{ userProfile.memberSince }}</p>
                  </div>
                }
                <div class="info-item">
                  <label>Statut</label>
                  <p><span class="status-badge active">Actif</span></p>
                </div>
              </div>
            </div>

            <div class="profile-section">
              <h3>Statistiques</h3>
              <div class="stats-grid">
                <div class="stat-card">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                  </svg>
                  <div>
                    <h4>{{ userProfile.totalClasses }}</h4>
                    <p>Cours inscrits</p>
                  </div>
                </div>
                <div class="stat-card">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <circle cx="12" cy="10" r="3"></circle>
                    <path d="M12 2a10 10 0 0 0-9.95 9h4.53a9.93 9.93 0 0 1 5.42-5.42V2z"></path>
                  </svg>
                  <div>
                    <h4>{{ certificates.length }}</h4>
                    <p>Certificats</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </main>
  </div>
</div>
